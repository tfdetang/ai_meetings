# 实施计划

- [x] 1. 设置项目结构和核心接口
  - 创建 Python 项目目录结构（models, services, adapters, storage）
  - 设置 pyproject.toml 或 requirements.txt 配置依赖
  - 配置 pytest 和 Hypothesis 测试框架
  - 定义核心数据模型（Agent, Meeting, Message, Role, ModelConfig）
  - 定义服务接口（IModelAdapter, IAgentService, IMeetingService, IStorageService）
  - _需求: 8.2, 8.3_

- [x] 2. 实现数据模型和验证
- [x] 2.1 创建核心数据模型类
  - 实现 Agent, Role, ModelConfig, Meeting, Message 数据类
  - 添加数据验证方法（字段长度、非空检查）
  - 实现模型的序列化和反序列化方法（to_dict, from_dict）
  - _需求: 1.1, 1.2, 3.1, 3.3_

- [x] 2.2 为数据模型编写属性测试
  - **属性 1: 代理创建完整性**
  - **验证需求: 1.1**

- [x] 2.3 为数据验证编写属性测试
  - **属性 11: 角色描述验证**
  - **验证需求: 3.3**

- [x] 2.4 为数据验证编写属性测试
  - **属性 21: 空消息拒绝**
  - **验证需求: 5.4**

- [x] 3. 实现存储服务
- [x] 3.1 实现文件系统存储
  - 创建 FileStorageService 类实现 IStorageService 接口
  - 实现代理的保存、加载、列表和删除操作
  - 实现会议的保存、加载、列表和删除操作
  - 使用 JSON 格式进行数据持久化
  - 处理文件系统错误（文件不存在、权限问题等）
  - _需求: 1.2, 1.3, 1.5, 6.2, 6.3, 6.5_

- [x] 3.2 为存储操作编写属性测试
  - **属性 2: 代理持久化往返**
  - **属性 6: API 凭证往返**
  - **属性 24: 会议加载往返**
  - **验证需求: 1.2, 2.2, 6.3**

- [x] 3.3 为列表和删除操作编写属性测试
  - **属性 3: 代理列表完整性**
  - **属性 5: 代理删除完整性**
  - **属性 23: 会议列表完整性**
  - **属性 26: 会议删除完整性**
  - **验证需求: 1.3, 1.5, 6.2, 6.5**

- [x] 4. 实现模型适配器
- [x] 4.1 创建模型适配器基础设施
  - 实现 IModelAdapter 抽象基类
  - 创建 ModelAdapterFactory 工厂类
  - 实现错误处理和重试逻辑
  - _需求: 2.3, 2.4, 8.1_

- [x] 4.2 实现 OpenAI 适配器
  - 创建 OpenAIAdapter 类
  - 实现 send_message 方法调用 OpenAI API
  - 实现 test_connection 方法
  - 处理 API 错误和速率限制
  - _需求: 2.1, 2.5_

- [ ] 4.3 实现 Anthropic 适配器
  - 创建 AnthropicAdapter 类
  - 实现 send_message 方法调用 Anthropic API
  - 实现 test_connection 方法
  - _需求: 2.1, 2.5_

- [ ] 4.4 实现 Google 适配器
  - 创建 GoogleAdapter 类
  - 实现 send_message 方法调用 Google AI API
  - 实现 test_connection 方法
  - _需求: 2.1, 2.5_

- [x] 4.5 实现 GLM 适配器
  - 创建 GLMAdapter 类
  - 实现 send_message 方法调用智谱 AI API (https://open.bigmodel.cn/api/paas/v4/chat/completions)
  - 实现 test_connection 方法
  - 支持流式和非流式响应
  - _需求: 2.1, 2.5_

- [x] 4.6 为模型适配器编写属性测试
  - **属性 7: API 错误处理**
  - **属性 8: 连接测试响应**
  - **验证需求: 2.4, 2.5**

- [x] 5. 实现代理服务
- [x] 5.1 创建 AgentService 类
  - 实现 IAgentService 接口
  - 实现 create_agent 方法（生成 ID、验证输入、保存）
  - 实现 update_agent 方法
  - 实现 delete_agent 方法
  - 实现 get_agent 和 list_agents 方法
  - 实现 test_agent_connection 方法
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 2.5_

- [x] 5.2 为代理服务编写属性测试
  - **属性 4: 代理更新一致性**
  - **验证需求: 1.4**

- [x] 5.3 为角色配置编写属性测试
  - **属性 9: 角色字段完整性**
  - **验证需求: 3.1**

- [x] 6. 实现会议服务核心功能
- [x] 6.1 创建 MeetingService 类基础
  - 实现 IMeetingService 接口
  - 实现 create_meeting 方法（验证主题和代理、生成 ID、初始化状态）
  - 实现 get_meeting、list_meetings、delete_meeting 方法
  - _需求: 4.1, 6.2, 6.5_

- [x] 6.2 为会议创建编写属性测试
  - **属性 12: 会议创建要求**
  - **属性 27: 会议配置接受**
  - **验证需求: 4.1, 7.1**

- [x] 6.3 实现会议状态管理
  - 实现 start_meeting 方法（状态转换为 active）
  - 实现 pause_meeting 方法（状态转换为 paused）
  - 实现 end_meeting 方法（状态转换为 ended、持久化）
  - 添加状态验证逻辑（防止非法状态转换）
  - _需求: 4.2, 4.6, 4.7_

- [x] 6.4 为会议状态编写属性测试
  - **属性 17: 暂停状态保持**
  - **属性 18: 结束状态持久化**
  - **验证需求: 4.6, 4.7**

- [x] 7. 实现会议发言逻辑
- [x] 7.1 实现发言顺序管理
  - 创建发言顺序管理器（顺序和随机模式）
  - 实现轮次跟踪逻辑
  - 实现代理选择逻辑
  - _需求: 4.2, 7.4, 7.5_

- [x] 7.2 为发言顺序编写属性测试
  - **属性 13: 发言顺序一致性**
  - **属性 30: 随机顺序变化**
  - **验证需求: 4.2, 7.4, 7.5**

- [x] 7.3 实现代理发言功能
  - 实现 request_agent_response 方法
  - 构建会议上下文（历史消息）
  - 调用模型适配器获取响应
  - 将响应添加到会议记录
  - 处理消息长度限制和截断
  - _需求: 4.3, 4.4, 7.3_

- [x] 7.4 为代理发言编写属性测试
  - **属性 10: 角色提示词传递**
  - **属性 14: 会议上下文传递**
  - **属性 15: 消息记录增长**
  - **属性 29: 消息长度截断**
  - **验证需求: 3.2, 4.3, 4.4, 7.3**

- [x] 7.5 实现轮次管理
  - 跟踪每轮发言
  - 实现轮次限制检查
  - 达到限制时自动结束会议
  - _需求: 4.5, 7.2_

- [x] 7.6 为轮次管理编写属性测试
  - **属性 16: 轮次递增**
  - **属性 28: 轮次限制自动结束**
  - **验证需求: 4.5, 7.2**

- [x] 8. 实现用户参与功能
- [x] 8.1 实现用户消息功能
  - 实现 add_user_message 方法
  - 验证消息内容（非空、长度限制）
  - 将用户消息添加到会议记录
  - 确保用户消息包含在后续代理上下文中
  - _需求: 5.1, 5.2, 5.4_

- [x] 8.2 为用户参与编写属性测试
  - **属性 19: 用户消息上下文传递**
  - **验证需求: 5.2**

- [x] 8.3 实现指定代理响应
  - 扩展 request_agent_response 支持用户指定
  - 验证指定的代理存在于会议中
  - _需求: 5.3_

- [x] 8.4 为指定代理编写属性测试
  - **属性 20: 指定代理响应**
  - **验证需求: 5.3**

- [x] 9. 实现会议历史和导出功能
- [x] 9.1 实现消息元数据
  - 确保所有消息包含发言者身份、时间戳
  - 实现消息格式化显示
  - _需求: 6.1_

- [x] 9.2 为消息元数据编写属性测试
  - **属性 22: 消息元数据完整性**
  - **验证需求: 6.1**

- [x] 9.3 实现会议导出功能
  - 实现 Markdown 格式导出
  - 实现 JSON 格式导出
  - 包含所有消息和元数据
  - _需求: 6.4_

- [x] 9.4 为会议导出编写属性测试
  - **属性 25: 会议导出格式**
  - **验证需求: 6.4**

- [x] 10. 实现角色模板功能
- [x] 10.1 创建预设角色模板
  - 定义常见角色模板（产品经理、工程师、设计师等）
  - 实现模板加载和应用功能
  - _需求: 3.4_

- [x] 11. 实现命令行界面（CLI）
- [x] 11.1 创建 CLI 基础结构
  - 使用 Click 或 argparse 创建命令行接口
  - 实现主菜单和导航
  - _需求: 所有需求的用户交互_

- [x] 11.2 实现代理管理 CLI 命令
  - 创建代理命令（create, list, update, delete, test）
  - 实现交互式输入和显示
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 2.5_

- [x] 11.3 实现会议管理 CLI 命令
  - 创建会议命令（create, start, pause, end, list, delete）
  - 实现会议进行中的交互（查看消息、发送消息、指定代理）
  - 实时显示会议进度
  - _需求: 4.1, 4.2, 4.6, 4.7, 5.1, 5.3, 6.1, 6.2, 6.5_

- [x] 11.4 实现会议历史和导出 CLI 命令
  - 查看历史会议命令
  - 导出会议记录命令
  - _需求: 6.2, 6.3, 6.4_

- [x] 12. 最终检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户
