# 实施计划

- [x] 1. 设置项目结构和核心接口
  - 创建 Python 项目目录结构（models, services, adapters, storage）
  - 设置 pyproject.toml 或 requirements.txt 配置依赖
  - 配置 pytest 和 Hypothesis 测试框架
  - 定义核心数据模型（Agent, Meeting, Message, Role, ModelConfig）
  - 定义服务接口（IModelAdapter, IAgentService, IMeetingService, IStorageService）
  - _需求: 8.2, 8.3_

- [x] 2. 实现数据模型和验证
- [x] 2.1 创建核心数据模型类
  - 实现 Agent, Role, ModelConfig, Meeting, Message 数据类
  - 添加数据验证方法（字段长度、非空检查）
  - 实现模型的序列化和反序列化方法（to_dict, from_dict）
  - _需求: 1.1, 1.2, 3.1, 3.3_

- [x] 2.2 为数据模型编写属性测试
  - **属性 1: 代理创建完整性**
  - **验证需求: 1.1**

- [x] 2.3 为数据验证编写属性测试
  - **属性 11: 角色描述验证**
  - **验证需求: 3.3**

- [x] 2.4 为数据验证编写属性测试
  - **属性 21: 空消息拒绝**
  - **验证需求: 5.4**

- [x] 3. 实现存储服务
- [x] 3.1 实现文件系统存储
  - 创建 FileStorageService 类实现 IStorageService 接口
  - 实现代理的保存、加载、列表和删除操作
  - 实现会议的保存、加载、列表和删除操作
  - 使用 JSON 格式进行数据持久化
  - 处理文件系统错误（文件不存在、权限问题等）
  - _需求: 1.2, 1.3, 1.5, 6.2, 6.3, 6.5_

- [x] 3.2 为存储操作编写属性测试
  - **属性 2: 代理持久化往返**
  - **属性 6: API 凭证往返**
  - **属性 24: 会议加载往返**
  - **验证需求: 1.2, 2.2, 6.3**

- [x] 3.3 为列表和删除操作编写属性测试
  - **属性 3: 代理列表完整性**
  - **属性 5: 代理删除完整性**
  - **属性 23: 会议列表完整性**
  - **属性 26: 会议删除完整性**
  - **验证需求: 1.3, 1.5, 6.2, 6.5**

- [x] 4. 实现模型适配器
- [x] 4.1 创建模型适配器基础设施
  - 实现 IModelAdapter 抽象基类
  - 创建 ModelAdapterFactory 工厂类
  - 实现错误处理和重试逻辑
  - _需求: 2.3, 2.4, 8.1_

- [x] 4.2 实现 OpenAI 适配器
  - 创建 OpenAIAdapter 类
  - 实现 send_message 方法调用 OpenAI API
  - 实现 test_connection 方法
  - 处理 API 错误和速率限制
  - _需求: 2.1, 2.5_

- [ ] 4.3 实现 Anthropic 适配器
  - 创建 AnthropicAdapter 类
  - 实现 send_message 方法调用 Anthropic API
  - 实现 test_connection 方法
  - _需求: 2.1, 2.5_

- [ ] 4.4 实现 Google 适配器
  - 创建 GoogleAdapter 类
  - 实现 send_message 方法调用 Google AI API
  - 实现 test_connection 方法
  - _需求: 2.1, 2.5_

- [x] 4.5 实现 GLM 适配器
  - 创建 GLMAdapter 类
  - 实现 send_message 方法调用智谱 AI API (https://open.bigmodel.cn/api/paas/v4/chat/completions)
  - 实现 test_connection 方法
  - 支持流式和非流式响应
  - _需求: 2.1, 2.5_

- [x] 4.6 为模型适配器编写属性测试
  - **属性 7: API 错误处理**
  - **属性 8: 连接测试响应**
  - **验证需求: 2.4, 2.5**

- [x] 5. 实现代理服务
- [x] 5.1 创建 AgentService 类
  - 实现 IAgentService 接口
  - 实现 create_agent 方法（生成 ID、验证输入、保存）
  - 实现 update_agent 方法
  - 实现 delete_agent 方法
  - 实现 get_agent 和 list_agents 方法
  - 实现 test_agent_connection 方法
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 2.5_

- [x] 5.2 为代理服务编写属性测试
  - **属性 4: 代理更新一致性**
  - **验证需求: 1.4**

- [x] 5.3 为角色配置编写属性测试
  - **属性 9: 角色字段完整性**
  - **验证需求: 3.1**

- [x] 6. 实现会议服务核心功能
- [x] 6.1 创建 MeetingService 类基础
  - 实现 IMeetingService 接口
  - 实现 create_meeting 方法（验证主题和代理、生成 ID、初始化状态）
  - 实现 get_meeting、list_meetings、delete_meeting 方法
  - _需求: 4.1, 6.2, 6.5_

- [x] 6.2 为会议创建编写属性测试
  - **属性 12: 会议创建要求**
  - **属性 27: 会议配置接受**
  - **验证需求: 4.1, 7.1**

- [x] 6.3 实现会议状态管理
  - 实现 start_meeting 方法（状态转换为 active）
  - 实现 pause_meeting 方法（状态转换为 paused）
  - 实现 end_meeting 方法（状态转换为 ended、持久化）
  - 添加状态验证逻辑（防止非法状态转换）
  - _需求: 4.2, 4.6, 4.7_

- [x] 6.4 为会议状态编写属性测试
  - **属性 17: 暂停状态保持**
  - **属性 18: 结束状态持久化**
  - **验证需求: 4.6, 4.7**

- [x] 7. 实现会议发言逻辑
- [x] 7.1 实现发言顺序管理
  - 创建发言顺序管理器（顺序和随机模式）
  - 实现轮次跟踪逻辑
  - 实现代理选择逻辑
  - _需求: 4.2, 7.4, 7.5_

- [x] 7.2 为发言顺序编写属性测试
  - **属性 13: 发言顺序一致性**
  - **属性 30: 随机顺序变化**
  - **验证需求: 4.2, 7.4, 7.5**

- [x] 7.3 实现代理发言功能
  - 实现 request_agent_response 方法
  - 构建会议上下文（历史消息）
  - 调用模型适配器获取响应
  - 将响应添加到会议记录
  - 处理消息长度限制和截断
  - _需求: 4.3, 4.4, 7.3_

- [x] 7.4 为代理发言编写属性测试
  - **属性 10: 角色提示词传递**
  - **属性 14: 会议上下文传递**
  - **属性 15: 消息记录增长**
  - **属性 29: 消息长度截断**
  - **验证需求: 3.2, 4.3, 4.4, 7.3**

- [x] 7.5 实现轮次管理
  - 跟踪每轮发言
  - 实现轮次限制检查
  - 达到限制时自动结束会议
  - _需求: 4.5, 7.2_

- [x] 7.6 为轮次管理编写属性测试
  - **属性 16: 轮次递增**
  - **属性 28: 轮次限制自动结束**
  - **验证需求: 4.5, 7.2**

- [x] 8. 实现用户参与功能
- [x] 8.1 实现用户消息功能
  - 实现 add_user_message 方法
  - 验证消息内容（非空、长度限制）
  - 将用户消息添加到会议记录
  - 确保用户消息包含在后续代理上下文中
  - _需求: 5.1, 5.2, 5.4_

- [x] 8.2 为用户参与编写属性测试
  - **属性 19: 用户消息上下文传递**
  - **验证需求: 5.2**

- [x] 8.3 实现指定代理响应
  - 扩展 request_agent_response 支持用户指定
  - 验证指定的代理存在于会议中
  - _需求: 5.3_

- [x] 8.4 为指定代理编写属性测试
  - **属性 20: 指定代理响应**
  - **验证需求: 5.3**

- [x] 9. 实现会议历史和导出功能
- [x] 9.1 实现消息元数据
  - 确保所有消息包含发言者身份、时间戳
  - 实现消息格式化显示
  - _需求: 6.1_

- [x] 9.2 为消息元数据编写属性测试
  - **属性 22: 消息元数据完整性**
  - **验证需求: 6.1**

- [x] 9.3 实现会议导出功能
  - 实现 Markdown 格式导出
  - 实现 JSON 格式导出
  - 包含所有消息和元数据
  - _需求: 6.4_

- [x] 9.4 为会议导出编写属性测试
  - **属性 25: 会议导出格式**
  - **验证需求: 6.4**

- [x] 10. 实现角色模板功能
- [x] 10.1 创建预设角色模板
  - 定义常见角色模板（产品经理、工程师、设计师等）
  - 实现模板加载和应用功能
  - _需求: 3.4_

- [x] 11. 实现命令行界面（CLI）
- [x] 11.1 创建 CLI 基础结构
  - 使用 Click 或 argparse 创建命令行接口
  - 实现主菜单和导航
  - _需求: 所有需求的用户交互_

- [x] 11.2 实现代理管理 CLI 命令
  - 创建代理命令（create, list, update, delete, test）
  - 实现交互式输入和显示
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 2.5_

- [x] 11.3 实现会议管理 CLI 命令
  - 创建会议命令（create, start, pause, end, list, delete）
  - 实现会议进行中的交互（查看消息、发送消息、指定代理）
  - 实时显示会议进度
  - _需求: 4.1, 4.2, 4.6, 4.7, 5.1, 5.3, 6.1, 6.2, 6.5_

- [x] 11.4 实现会议历史和导出 CLI 命令
  - 查看历史会议命令
  - 导出会议记录命令
  - _需求: 6.2, 6.3, 6.4_

- [x] 12. 最终检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

- [x] 13. 扩展数据模型以支持新功能
- [x] 13.1 添加主持人和议题相关数据模型
  - 在 Meeting 模型中添加 moderator_id, moderator_type, agenda 字段
  - 创建 AgendaItem 数据类（id, title, description, completed, created_at）
  - 创建 Mention 数据类（mentioned_participant_id, mentioned_participant_name, message_id）
  - 在 Message 模型中添加 mentions 字段
  - 更新序列化和反序列化方法
  - _需求: 9.1, 10.1, 15.1_

- [ ]* 13.2 为主持人配置编写属性测试
  - **属性 31: 主持人配置完整性**
  - **验证需求: 9.1**

- [x] 13.3 添加会议纪要数据模型
  - 创建 MeetingMinutes 数据类（id, content, summary, key_decisions, action_items, created_at, created_by, version）
  - 在 Meeting 模型中添加 minutes_history, current_minutes 字段
  - 更新序列化和反序列化方法
  - _需求: 13.3, 14.4_

- [x] 13.4 添加会议配置扩展
  - 创建 DiscussionStyle 和 SpeakingLength 枚举
  - 在 MeetingConfig 中添加 discussion_style, speaking_length_preferences 字段
  - 更新配置的序列化和反序列化
  - _需求: 11.1, 11.2_

- [ ]* 13.5 为配置扩展编写属性测试
  - **属性 38: 讨论风格配置**
  - **属性 39: 发言长度偏好配置**
  - **验证需求: 11.1, 11.2**

- [x] 14. 实现议题管理功能
- [x] 14.1 实现议题操作方法
  - 在 MeetingService 中实现 add_agenda_item 方法
  - 实现 remove_agenda_item 方法
  - 实现 mark_agenda_completed 方法
  - 添加议题操作的权限检查（仅主持人可操作）
  - _需求: 10.1, 10.2, 10.3_

- [ ]* 14.2 为议题管理编写属性测试
  - **属性 34: 初始议题列表接受**
  - **属性 35: 议题动态添加**
  - **属性 36: 议题状态管理**
  - **验证需求: 10.1, 10.2, 10.3**

- [x] 15. 实现上下文构建增强
- [x] 15.1 实现系统提示词构建器
  - 创建 build_system_prompt 函数
  - 实现角色描述注入
  - 实现讨论风格指导注入
  - 实现发言长度偏好注入
  - 实现主持人职责注入（针对主持人代理）
  - _需求: 9.3, 11.3, 12.3, 12.4_

- [ ]* 15.2 为系统提示词构建编写属性测试
  - **属性 32: 主持人系统提示词增强**
  - **属性 40: 配置注入系统提示词**
  - **属性 43: 角色描述上下文注入**
  - **属性 44: 主持人职责上下文注入**
  - **验证需求: 9.3, 11.3, 12.3, 12.4**

- [x] 15.3 实现会议上下文构建器
  - 创建 build_meeting_context 函数
  - 实现会议主题和主持人信息注入
  - 实现参会者列表注入
  - 实现议题列表注入
  - 实现会议结论注入（如果有纪要）
  - 实现@提及标注检查
  - _需求: 10.5, 12.1, 12.2, 12.5, 12.6, 15.2_

- [ ]* 15.4 为会议上下文构建编写属性测试
  - **属性 37: 议题上下文注入**
  - **属性 42: 会议结论上下文注入**
  - **属性 45: 参会者列表上下文注入**
  - **属性 46: 主持人身份上下文注入**
  - **验证需求: 10.5, 12.1, 12.2, 12.5, 12.6**

- [x] 15.5 实现历史消息构建器
  - 创建 build_message_history 函数
  - 实现基于会议纪要的上下文优化（使用纪要替代之前的历史）
  - 实现纪要后新消息的包含逻辑
  - 实现无纪要时的全量历史消息构建
  - _需求: 13.4, 13.5_

- [ ]* 15.6 为历史消息构建编写属性测试
  - **属性 49: 纪要优化上下文**
  - **属性 50: 纪要后新消息包含**
  - **验证需求: 13.4, 13.5**

- [x] 15.7 集成上下文构建到代理发言流程
  - 更新 request_agent_response 方法使用新的上下文构建器
  - 确保所有上下文信息正确传递给模型适配器
  - _需求: 9.2, 11.3, 12.1-12.6_

- [ ]* 15.8 为配置更新应用编写属性测试
  - **属性 41: 配置更新应用**
  - **验证需求: 11.4**

- [x] 16. 实现@提及功能
- [x] 16.1 实现提及解析
  - 创建 parse_mentions 函数
  - 实现正则表达式匹配 @用户名 和 @"用户名"
  - 实现参会者名称匹配和 Mention 对象创建
  - 在 add_user_message 和 request_agent_response 中集成提及解析
  - _需求: 15.1_

- [ ]* 16.2 为提及解析编写属性测试
  - **属性 55: 提及解析**
  - **验证需求: 15.1**

- [x] 16.3 实现提及驱动的发言顺序
  - 创建 get_next_speaker 函数
  - 实现@提及优先逻辑（被提及的AI代理优先发言）
  - 集成到会议发言流程中
  - _需求: 15.3_

- [ ]* 16.4 为提及优先发言编写属性测试
  - **属性 57: 提及优先发言**
  - **验证需求: 15.3**

- [ ]* 16.5 为提及上下文标注编写属性测试
  - **属性 56: 提及上下文标注**
  - **验证需求: 15.2**

- [x] 17. 实现会议纪要功能
- [x] 17.1 实现纪要生成
  - 在 MeetingService 中实现 generate_minutes 方法
  - 实现使用AI模型总结会议内容的逻辑
  - 构建纪要生成的提示词（总结关键点、决策、待办事项）
  - 创建 MeetingMinutes 对象并保存到会议
  - _需求: 13.1, 13.2, 13.3, 14.1_

- [ ]* 17.2 为纪要生成编写属性测试
  - **属性 47: 纪要生成功能**
  - **属性 48: 纪要持久化**
  - **验证需求: 13.1, 13.3, 14.1**

- [x] 17.3 实现纪要手动编辑
  - 实现 update_minutes 方法（手动编辑模式）
  - 更新纪要内容并创建新版本
  - 保存到版本历史
  - _需求: 14.2, 14.4_

- [ ]* 17.4 为纪要编辑编写属性测试
  - **属性 51: 纪要手动编辑**
  - **属性 53: 纪要版本历史**
  - **验证需求: 14.2, 14.4**

- [x] 17.5 实现纪要AI更新
  - 扩展 generate_minutes 方法支持指定AI代理
  - 实现使用指定代理更新纪要的逻辑
  - 创建新版本并保存
  - _需求: 14.3, 14.4_

- [ ]* 17.6 为纪要AI更新编写属性测试
  - **属性 52: 纪要AI更新**
  - **验证需求: 14.3**

- [ ]* 17.7 为当前纪要显示编写属性测试
  - **属性 54: 当前纪要显示**
  - **验证需求: 14.5**

- [x] 18. 更新CLI以支持新功能
- [x] 18.1 扩展会议创建命令
  - 添加主持人选择（用户或选择AI代理）
  - 添加初始议题输入
  - 添加讨论风格选择
  - 添加发言长度偏好配置
  - _需求: 9.1, 10.1, 11.1, 11.2_

- [x] 18.2 添加议题管理命令
  - 实现添加议题命令
  - 实现删除议题命令
  - 实现标记议题完成命令
  - 实现查看议题列表命令
  - _需求: 10.2, 10.3_

- [x] 18.3 添加会议纪要命令
  - 实现生成纪要命令
  - 实现查看纪要命令
  - 实现手动编辑纪要命令
  - 实现AI更新纪要命令（选择代理）
  - 实现查看纪要历史命令
  - _需求: 13.1, 14.1, 14.2, 14.3, 14.5_

- [x] 18.4 增强消息显示
  - 实现@提及的高亮显示
  - 显示主持人标识
  - 显示当前议题
  - _需求: 9.4, 15.5_

- [x] 18.5 添加会议配置更新命令
  - 实现更新讨论风格命令
  - 实现更新发言长度偏好命令
  - _需求: 11.4_

- [x] 19. 更新Web API以支持新功能
- [x] 19.1 扩展会议API端点
  - 更新 POST /meetings 接受主持人、议题、配置参数
  - 添加 POST /meetings/{id}/agenda 添加议题
  - 添加 DELETE /meetings/{id}/agenda/{item_id} 删除议题
  - 添加 PATCH /meetings/{id}/agenda/{item_id} 标记议题完成
  - 添加 PATCH /meetings/{id}/config 更新会议配置
  - _需求: 9.1, 10.1, 10.2, 10.3, 11.4_

- [x] 19.2 添加会议纪要API端点
  - 添加 POST /meetings/{id}/minutes 生成纪要
  - 添加 GET /meetings/{id}/minutes 获取当前纪要
  - 添加 PUT /meetings/{id}/minutes 更新纪要
  - 添加 GET /meetings/{id}/minutes/history 获取纪要历史
  - _需求: 13.1, 14.1, 14.2, 14.3, 14.5_

- [x] 19.3 更新消息API
  - 在消息响应中包含@提及信息
  - 在会议详情中包含主持人信息
  - 在会议详情中包含议题列表
  - _需求: 9.4, 15.1_

- [x] 20. 更新Web前端以支持新功能
- [x] 20.1 扩展会议创建界面
  - 添加主持人选择UI
  - 添加议题输入UI
  - 添加讨论风格选择UI
  - 添加发言长度偏好配置UI
  - _需求: 9.1, 10.1, 11.1, 11.2_

- [x] 20.2 添加议题管理界面
  - 显示议题列表（带完成状态）
  - 添加议题操作按钮（添加、删除、标记完成）
  - 仅对主持人显示操作按钮
  - _需求: 10.2, 10.3_

- [x] 20.3 添加会议纪要界面
  - 添加生成纪要按钮
  - 显示当前纪要内容
  - 添加编辑纪要功能
  - 添加AI更新纪要功能（选择代理）
  - 添加查看纪要历史功能
  - _需求: 13.1, 14.1, 14.2, 14.3, 14.5_

- [x] 20.4 增强消息显示
  - 实现@提及的高亮显示和点击跳转
  - 显示主持人徽章
  - 在输入框支持@自动补全参会者名称
  - _需求: 9.4, 15.4, 15.5_

- [x] 20.5 添加会议信息面板
  - 显示会议主持人
  - 显示所有参会者列表
  - 显示当前议题
  - 显示会议配置（风格、长度偏好）
  - _需求: 9.4, 12.5, 12.6_

- [x] 21. 最终检查点 - 确保所有新功能测试通过
  - 运行所有单元测试和属性测试
  - 确保所有新功能正常工作
  - 如有问题请询问用户


- [x] 22. 实现首页优化 - 进行中会议展示
- [x] 22.1 添加进行中会议数据获取
  - 在首页加载时获取所有会议列表
  - 过滤状态为 active 的会议
  - 按 updated_at 降序排序并取前5个
  - _需求: 16.1, 16.2, 16.5_

- [x] 22.2 实现进行中会议列表UI
  - 创建"进行中的会议"卡片组件
  - 显示会议主题、参与代理数量、消息数量
  - 显示最后更新时间
  - 实现点击跳转到会议室
  - 添加空状态提示
  - _需求: 16.1, 16.2, 16.3, 16.4_

- [ ]* 22.3 为首页优化编写属性测试
  - **属性 58: 进行中会议列表展示**
  - **属性 59: 进行中会议点击跳转**
  - **验证需求: 16.1, 16.2, 16.3, 16.5**

- [x] 23. 实现代理列表页面优化
- [x] 23.1 增强代理卡片布局
  - 添加角色描述展示区域
  - 实现角色描述的展开/收起功能（使用 Ant Design Paragraph ellipsis）
  - 添加模型供应商和模型名称标签展示
  - 优化视觉层次（名称、角色、模型信息）
  - _需求: 17.1, 17.2, 17.3, 17.4_

- [x] 23.2 优化空状态显示
  - 添加友好的空状态提示
  - 提供"创建第一个代理"的引导按钮
  - _需求: 17.5_

- [ ]* 23.3 为代理列表优化编写属性测试
  - **属性 60: 代理详细信息展示**
  - **属性 61: 角色描述展开功能**
  - **验证需求: 17.1, 17.2, 17.3, 17.4**

- [x] 24. 实现会议信息面板折叠功能
- [x] 24.1 添加折叠状态管理
  - 创建 meetingInfoCollapsed 状态
  - 使用 localStorage 持久化折叠状态
  - 实现状态切换逻辑
  - _需求: 18.1, 18.2, 18.5_

- [x] 24.2 实现折叠面板UI
  - 修改会议信息卡片标题为可点击
  - 添加折叠/展开图标
  - 在折叠状态显示关键信息摘要（参与者数量、状态）
  - 实现展开状态显示完整信息
  - _需求: 18.2, 18.3, 18.4_

- [ ]* 24.3 为面板折叠编写属性测试
  - **属性 62: 会议信息面板折叠状态持久化**
  - **属性 63: 折叠面板显示摘要信息**
  - **验证需求: 18.3, 18.5**

- [x] 25. 实现会议纪要图标化
- [x] 25.1 添加纪要浮动按钮
  - 使用 Ant Design FloatButton 组件
  - 固定在页面右上角
  - 根据是否有纪要显示不同图标和提示
  - 添加徽章指示纪要状态
  - _需求: 19.1, 19.5_

- [x] 25.2 实现纪要抽屉展示
  - 创建纪要抽屉组件（Drawer）
  - 显示纪要内容、版本信息
  - 添加编辑、历史、重新生成按钮
  - 实现点击外部或关闭按钮关闭抽屉
  - _需求: 19.2, 19.3, 19.4_

- [x] 25.3 移除原有的纪要卡片展示
  - 删除会议室页面中的纪要卡片组件
  - 确保所有纪要功能通过抽屉访问
  - _需求: 19.1_

- [ ]* 25.4 为纪要图标化编写属性测试
  - **属性 64: 纪要图标状态指示**
  - **验证需求: 19.1, 19.5**

- [x] 26. 实现议题侧边栏
- [x] 26.1 创建议题侧边栏组件
  - 实现可收起的侧边栏布局
  - 添加展开/收起按钮
  - 使用 localStorage 持久化侧边栏状态
  - _需求: 20.1, 20.2, 20.6_

- [x] 26.2 实现侧边栏内容
  - 展开状态显示完整议题列表
  - 收起状态显示图标和未完成议题数量徽章
  - 实时更新议题显示
  - 添加议题完成状态的视觉指示
  - _需求: 20.3, 20.4, 20.5_

- [x] 26.3 调整会议室布局
  - 使用 Flexbox 布局容纳侧边栏和主内容区
  - 确保侧边栏固定在左侧或右侧
  - 调整主内容区宽度适应侧边栏
  - _需求: 20.1_

- [x] 26.4 移除原有的议题卡片展示
  - 删除会议室页面中的议题卡片组件
  - 确保所有议题功能通过侧边栏访问
  - _需求: 20.1_

- [ ]* 26.5 为议题侧边栏编写属性测试
  - **属性 65: 议题侧边栏状态持久化**
  - **属性 66: 议题侧边栏徽章显示**
  - **验证需求: 20.3, 20.6**

- [x] 27. 实现消息输入框固定底部
- [x] 27.1 重构会议室页面布局
  - 使用 Flexbox 创建垂直布局结构
  - 顶部：会议标题和控制按钮（flexShrink: 0）
  - 中间：消息列表（flex: 1, overflowY: auto）
  - 底部：输入区域（flexShrink: 0, position: sticky）
  - _需求: 21.1, 21.3_

- [x] 27.2 优化输入区域样式
  - 限制输入区域最大高度为视口的20%
  - 设置输入框为固定行数（3行）
  - 禁用手动调整大小（resize: none）
  - 实现内容超出时内部滚动
  - 添加边框和背景色区分
  - _需求: 21.2, 21.4, 21.5_

- [x] 27.3 调整消息列表区域
  - 确保消息列表可独立滚动
  - 优化消息列表的最大高度计算
  - 保持自动滚动到底部功能
  - _需求: 21.3_

- [ ]* 27.4 为输入框固定编写属性测试
  - **属性 67: 消息输入区域高度限制**
  - **属性 68: 输入框固定底部**
  - **验证需求: 21.2, 21.3**

- [x] 28. 最终检查点 - 确保所有前端优化功能正常工作
  - 测试首页进行中会议展示
  - 测试代理列表详细信息展示
  - 测试会议信息面板折叠功能
  - 测试会议纪要图标化和抽屉展示
  - 测试议题侧边栏展开/收起
  - 测试消息输入框固定底部
  - 确保所有状态持久化正常工作
  - 如有问题请询问用户


- [x] 29. 实现思维导图数据模型和服务接口
- [x] 29.1 添加思维导图数据模型
  - 创建 MindMapNode 数据类（id, content, level, parent_id, children_ids, message_references, metadata）
  - 创建 MindMap 数据类（id, meeting_id, root_node, nodes, created_at, created_by, version）
  - 在 Meeting 模型中添加 mind_map 字段
  - 更新序列化和反序列化方法
  - _需求: 22.3, 22.5_

- [ ]* 29.2 为思维导图数据模型编写属性测试
  - **属性 73: 思维导图访问入口**
  - **验证需求: 22.5**

- [x] 29.3 扩展 IMeetingService 接口
  - 添加 generate_mind_map 方法签名
  - 添加 update_mind_map 方法签名
  - 添加 export_mind_map 方法签名
  - _需求: 22.1, 22.4, 24.1_

- [x] 30. 实现思维导图生成功能
- [x] 30.1 实现思维导图生成核心逻辑
  - 在 MeetingService 中实现 generate_mind_map 方法
  - 创建根节点（会议主题）
  - 为每个议题创建一级分支节点
  - 使用 AI 模型分析会议内容提取关键讨论点
  - 构建思维导图节点树结构
  - 建立节点与消息的引用关系
  - _需求: 22.1, 22.2_

- [ ]* 30.2 为思维导图生成编写属性测试
  - **属性 69: 思维导图生成功能**
  - **属性 70: 思维导图结构正确性**
  - **验证需求: 22.1, 22.2**

- [x] 30.3 实现思维导图生成的 AI 提示词
  - 创建 build_mind_map_generation_prompt 函数
  - 构建包含会议主题、议题、消息的提示词
  - 定义 JSON 输出格式要求
  - 实现 AI 响应的解析逻辑
  - _需求: 22.1_

- [x] 30.4 实现思维导图持久化
  - 将生成的思维导图保存到 Meeting 对象
  - 更新存储服务以支持思维导图序列化
  - 实现思维导图的加载和恢复
  - _需求: 22.3_

- [ ]* 30.5 为思维导图持久化编写属性测试
  - **属性 71: 思维导图持久化**
  - **验证需求: 22.3**

- [x] 30.6 实现思维导图更新功能
  - 实现 update_mind_map 方法
  - 支持重新生成思维导图（版本递增）
  - 保留旧版本的思维导图数据（可选）
  - _需求: 22.4_

- [ ]* 30.7 为思维导图更新编写属性测试
  - **属性 72: 思维导图更新功能**
  - **验证需求: 22.4**

- [x] 31. 实现思维导图导出功能
- [x] 31.1 创建思维导图导出器类
  - 创建 MindMapExporter 类
  - 实现 export_as_json 方法
  - 实现 export_as_markdown 方法
  - 实现 export_as_svg 方法
  - 实现 export_as_png 方法
  - _需求: 24.1, 24.2, 24.3, 24.4_

- [ ]* 31.2 为导出格式支持编写属性测试
  - **属性 80: 导出格式支持**
  - **验证需求: 24.1**

- [x] 31.3 实现 JSON 导出
  - 序列化思维导图为 JSON 格式
  - 包含所有节点和关系信息
  - 确保可以反序列化回思维导图对象
  - _需求: 24.3_

- [ ]* 31.4 为 JSON 导出编写属性测试
  - **属性 82: JSON 导出往返一致性**
  - **验证需求: 24.3**

- [x] 31.5 实现 Markdown 导出
  - 递归遍历思维导图节点
  - 使用缩进列表表示层级结构
  - 包含消息引用信息
  - _需求: 24.4_

- [ ]* 31.6 为 Markdown 导出编写属性测试
  - **属性 83: Markdown 导出层级结构**
  - **验证需求: 24.4**

- [x] 31.7 实现图片格式导出
  - 使用图形库（graphviz 或 matplotlib）生成 SVG
  - 实现 SVG 到 PNG 的转换
  - 确保图片包含完整的思维导图内容
  - _需求: 24.2_

- [ ]* 31.8 为图片导出编写属性测试
  - **属性 81: 图片格式导出有效性**
  - **验证需求: 24.2**

- [x] 31.9 集成导出功能到服务
  - 在 MeetingService 中实现 export_mind_map 方法
  - 调用 MindMapExporter 根据格式导出
  - 返回文件数据（bytes）
  - _需求: 24.5_

- [ ]* 31.10 为导出结果编写属性测试
  - **属性 84: 导出结果可用性**
  - **验证需求: 24.5**

- [x] 32. 实现思维导图 Web API
- [x] 32.1 添加思维导图 API 端点
  - 添加 POST /meetings/{id}/mind-map 生成思维导图
  - 添加 GET /meetings/{id}/mind-map 获取思维导图
  - 添加 PUT /meetings/{id}/mind-map 更新思维导图
  - 添加 POST /meetings/{id}/mind-map/export 导出思维导图
  - _需求: 22.1, 22.4, 22.5, 24.1_

- [x] 32.2 实现生成思维导图端点
  - 接收会议 ID 和可选的生成者 ID
  - 调用 MeetingService.generate_mind_map
  - 返回生成的思维导图数据
  - 处理错误情况（会议不存在、生成失败等）
  - _需求: 22.1_

- [x] 32.3 实现导出思维导图端点
  - 接收会议 ID 和导出格式参数
  - 调用 MeetingService.export_mind_map
  - 设置正确的 Content-Type 和文件名
  - 返回文件数据流
  - _需求: 24.1, 24.5_

- [x] 33. 实现思维导图前端可视化
- [x] 33.1 安装和配置 React Flow
  - 安装 react-flow-renderer 或 @xyflow/react 包
  - 创建思维导图可视化组件基础结构
  - 配置 React Flow 的基本设置
  - _需求: 23.1_

- [x] 33.2 实现思维导图数据转换
  - 创建将 MindMap 数据转换为 React Flow 节点的函数
  - 创建将节点关系转换为 React Flow 边的函数
  - 实现树形布局算法（计算节点位置）
  - _需求: 23.1_

- [ ]* 33.3 为思维导图渲染编写属性测试
  - **属性 74: 思维导图渲染完整性**
  - **验证需求: 23.1**

- [x] 33.4 实现节点展开/折叠功能
  - 创建 expandedNodes 状态管理
  - 实现节点点击处理函数
  - 根据展开状态动态计算可见节点和边
  - 更新 React Flow 显示
  - _需求: 23.2_

- [ ]* 33.5 为节点展开折叠编写属性测试
  - **属性 75: 节点展开折叠状态切换**
  - **验证需求: 23.2**

- [x] 33.6 实现节点悬停详情显示
  - 创建 tooltip 状态管理
  - 实现节点 onMouseEnter 和 onMouseLeave 处理
  - 创建悬浮提示框组件显示节点详情和消息引用
  - 定位提示框到节点附近
  - _需求: 23.3_

- [ ]* 33.7 为节点详情显示编写属性测试
  - **属性 76: 节点详细信息显示**
  - **验证需求: 23.3**

- [x] 33.8 实现消息引用跳转
  - 在提示框中渲染消息引用链接
  - 实现点击跳转到会议记录对应消息
  - 高亮显示目标消息
  - _需求: 23.4_

- [ ]* 33.9 为消息引用跳转编写属性测试
  - **属性 77: 消息引用跳转**
  - **验证需求: 23.4**

- [x] 33.10 实现视图变换功能
  - 使用 React Flow 内置的拖拽和缩放功能
  - 添加缩放控制按钮（放大、缩小、适应视图）
  - 添加全部展开/折叠按钮
  - _需求: 23.5_

- [ ]* 33.11 为视图变换编写属性测试
  - **属性 78: 视图变换状态管理**
  - **验证需求: 23.5**

- [x] 34. 实现思维导图搜索和导出 UI
- [x] 34.1 实现思维导图搜索功能
  - 添加搜索输入框到工具栏
  - 实现搜索关键词匹配节点内容
  - 高亮显示匹配的节点
  - 自动展开匹配节点的路径
  - _需求: 23.6_

- [ ]* 34.2 为搜索功能编写属性测试
  - **属性 79: 思维导图搜索功能**
  - **验证需求: 23.6**

- [x] 34.3 实现思维导图导出 UI
  - 添加导出按钮到工具栏
  - 创建导出格式选择下拉菜单（PNG、SVG、JSON、Markdown）
  - 实现调用后端导出 API
  - 实现文件下载触发
  - 显示导出进度和结果提示
  - _需求: 24.1, 24.5_

- [x] 34.4 创建思维导图页面或模态框
  - 创建独立的思维导图查看页面或全屏模态框
  - 集成思维导图可视化组件
  - 添加工具栏（搜索、缩放、展开/折叠、导出）
  - 添加返回会议室的导航
  - _需求: 23.1_

- [x] 35. 集成思维导图到会议界面
- [x] 35.1 添加思维导图入口
  - 在会议室页面添加"查看思维导图"按钮或图标
  - 根据是否有思维导图显示不同状态（生成/查看）
  - 实现点击打开思维导图视图
  - _需求: 22.5_

- [x] 35.2 实现生成思维导图触发
  - 添加"生成思维导图"按钮
  - 实现调用后端生成 API
  - 显示生成进度（loading 状态）
  - 生成完成后自动打开思维导图视图
  - 处理生成失败的错误提示
  - _需求: 22.1_

- [x] 35.3 实现思维导图与会议纪要的集成
  - 在纪要抽屉中添加"同时生成思维导图"选项
  - 支持同时生成纪要和思维导图
  - 在思维导图中引用纪要的关键决策
  - 提供纪要和思维导图的切换视图
  - _需求: 22.1, 22.2_

- [ ] 36. 更新 CLI 以支持思维导图
- [ ] 36.1 添加思维导图 CLI 命令
  - 实现生成思维导图命令（meeting mind-map generate）
  - 实现查看思维导图命令（meeting mind-map view）
  - 实现导出思维导图命令（meeting mind-map export）
  - 在 CLI 中以文本树形式显示思维导图结构
  - _需求: 22.1, 22.5, 24.1_

- [ ] 37. 最终检查点 - 确保所有思维导图功能正常工作
  - 测试思维导图生成功能
  - 测试思维导图可视化和交互（展开/折叠、悬停、跳转）
  - 测试思维导图搜索功能
  - 测试思维导图导出（所有格式）
  - 测试思维导图持久化和加载
  - 运行所有相关的属性测试
  - 确保所有测试通过，如有问题请询问用户
