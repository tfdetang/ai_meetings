# Markdown 支持说明

## 功能概述

会议消息现在支持完整的 Markdown 格式渲染，让 AI 代理的回复更加丰富和易读。

## 支持的 Markdown 语法

### 1. 标题

```markdown
# 一级标题
## 二级标题
### 三级标题
#### 四级标题
```

**效果**:
- 一级和二级标题带有下划线
- 标题有合适的字体大小和间距

### 2. 文本格式

```markdown
**粗体文本**
*斜体文本*
~~删除线~~
`行内代码`
```

**效果**:
- **粗体**: 加粗显示
- *斜体*: 倾斜显示
- ~~删除线~~: 带删除线
- `代码`: 灰色背景高亮

### 3. 列表

**无序列表**:
```markdown
- 项目 1
- 项目 2
  - 子项目 2.1
  - 子项目 2.2
- 项目 3
```

**有序列表**:
```markdown
1. 第一步
2. 第二步
3. 第三步
```

**任务列表**:
```markdown
- [x] 已完成任务
- [ ] 待完成任务
```

### 4. 链接和图片

**链接**:
```markdown
[链接文本](https://example.com)
```

**图片**:
```markdown
![图片描述](https://example.com/image.jpg)
```

**特性**:
- 链接自动在新标签页打开
- 图片自动适应宽度
- 图片懒加载优化性能

### 5. 代码块

**行内代码**:
```markdown
使用 `console.log()` 输出日志
```

**代码块**:
````markdown
```python
def hello_world():
    print("Hello, World!")
```
````

**特性**:
- 语法高亮（根据语言）
- 灰色背景区分
- 水平滚动支持长代码

### 6. 引用

```markdown
> 这是一段引用文本
> 可以有多行
```

**效果**:
- 左侧蓝色竖线
- 灰色文字
- 斜体显示

### 7. 表格

```markdown
| 列1 | 列2 | 列3 |
|-----|-----|-----|
| 数据1 | 数据2 | 数据3 |
| 数据4 | 数据5 | 数据6 |
```

**特性**:
- 自动表格样式
- 斑马纹行
- 响应式滚动

### 8. 水平线

```markdown
---
或
***
```

**效果**: 灰色分隔线

## 使用示例

### 示例 1: 结构化回复

AI 代理可以这样回复：

```markdown
## 分析结果

根据数据分析，我发现以下问题：

### 主要问题
1. **用户留存率下降** - 从 65% 降至 50%
2. **活跃度降低** - 日活用户减少 20%
3. **转化率下滑** - 付费转化率下降 15%

### 建议方案

#### 短期措施
- 优化新手引导流程
- 增加用户激励机制
- 改进核心功能体验

#### 长期策略
- 建立用户反馈机制
- 数据驱动产品迭代
- 持续优化用户体验

### 预期效果

| 指标 | 当前值 | 目标值 | 提升幅度 |
|------|--------|--------|----------|
| 留存率 | 50% | 60% | +20% |
| 日活 | 8000 | 10000 | +25% |
| 转化率 | 3% | 4% | +33% |
```

### 示例 2: 代码示例

技术讨论时，AI 可以提供代码：

```markdown
## 技术实现方案

### 前端实现

```javascript
// 用户认证逻辑
async function authenticateUser(credentials) {
  try {
    const response = await fetch('/api/auth', {
      method: 'POST',
      body: JSON.stringify(credentials)
    });
    return await response.json();
  } catch (error) {
    console.error('认证失败:', error);
  }
}
```

### 后端实现

```python
from fastapi import FastAPI, HTTPException

@app.post("/api/auth")
async def authenticate(credentials: Credentials):
    user = await verify_credentials(credentials)
    if not user:
        raise HTTPException(status_code=401)
    return {"token": generate_token(user)}
```

### 注意事项

> ⚠️ **安全提示**: 
> - 使用 HTTPS 传输敏感信息
> - 实现速率限制防止暴力破解
> - 定期更新依赖库
```

### 示例 3: 流程图（使用文本）

```markdown
## 用户注册流程

```
1. 用户访问注册页面
   ↓
2. 填写注册信息
   ↓
3. 提交表单
   ↓
4. 后端验证
   ├─ 验证通过 → 创建账户 → 发送欢迎邮件
   └─ 验证失败 → 返回错误信息
```

**关键步骤**:
- [x] 邮箱格式验证
- [x] 密码强度检查
- [x] 防止重复注册
- [ ] 手机号验证（待实现）
```

## 开关 Markdown 渲染

### 切换方式

在会议消息卡片的标题栏右侧，有一个 "Markdown 渲染" 开关：

- **开启**（默认）: 消息以 Markdown 格式渲染
- **关闭**: 消息以纯文本显示

### 何时关闭？

- 查看原始文本格式
- 调试 Markdown 语法
- 消息包含特殊字符导致渲染异常

## 最佳实践

### 1. 让 AI 使用 Markdown

在提示词中引导 AI 使用 Markdown：

```
@技术负责人 请用 Markdown 格式详细说明技术方案，
包括代码示例、步骤说明和注意事项。
```

### 2. 结构化回复

鼓励 AI 使用标题、列表等结构化内容：

```
@产品经理 请分析用户需求，用以下格式回复：
## 需求分析
### 核心需求
### 次要需求
## 优先级排序
## 实现建议
```

### 3. 使用表格展示数据

```
@数据分析师 请用表格形式展示各项指标的对比数据
```

### 4. 代码示例

```
@工程师 请提供代码实现，使用代码块格式
```

## 技术细节

### 使用的库

- **react-markdown**: Markdown 渲染核心
- **remark-gfm**: GitHub Flavored Markdown 支持
- **rehype-raw**: HTML 标签支持
- **rehype-sanitize**: XSS 防护

### 安全性

- ✅ 自动清理危险的 HTML 标签
- ✅ 防止 XSS 攻击
- ✅ 安全的图片加载
- ✅ 外部链接在新标签页打开

### 性能优化

- ✅ 图片懒加载
- ✅ 代码块语法高亮
- ✅ 响应式表格滚动
- ✅ 移动端适配

## 样式定制

### 主题颜色

- 链接: 蓝色 (#1890ff)
- 代码背景: 浅灰 (#f6f8fa)
- 引用边框: 灰色 (#dfe2e5)
- 表格边框: 浅灰 (#dfe2e5)

### 响应式设计

- 桌面端: 正常字体大小
- 移动端: 自动缩小字体
- 表格: 水平滚动
- 图片: 自适应宽度

## 常见问题

### Q: 为什么我的 Markdown 没有渲染？

**检查**:
1. Markdown 渲染开关是否开启
2. 语法是否正确
3. 查看浏览器控制台是否有错误

### Q: 图片无法显示？

**原因**:
- 图片 URL 无效
- 图片服务器不允许外链
- 网络连接问题

**解决**:
- 使用有效的图片 URL
- 使用支持外链的图片托管服务

### Q: 代码块没有语法高亮？

**说明**:
- 当前版本使用简单的代码块样式
- 未来版本会添加完整的语法高亮

### Q: 表格在移动端显示不全？

**解决**:
- 表格会自动添加水平滚动
- 可以左右滑动查看完整内容

## 示例提示词

### 请求结构化回复

```
@产品经理 请用 Markdown 格式回复，包括：
- 使用 ## 标题分段
- 使用列表列举要点
- 使用表格对比数据
- 使用引用标注重点
```

### 请求代码示例

```
@工程师 请提供实现方案，要求：
- 使用代码块展示代码
- 添加注释说明
- 列出关键步骤
- 标注注意事项
```

### 请求数据分析

```
@数据分析师 请分析数据并用 Markdown 格式回复：
- 使用表格展示数据
- 使用列表总结发现
- 使用引用标注关键结论
```

## 未来计划

- [ ] 完整的语法高亮支持
- [ ] Mermaid 图表支持
- [ ] LaTeX 数学公式支持
- [ ] 自定义主题颜色
- [ ] 导出时保留 Markdown 格式
- [ ] 消息编辑器支持 Markdown 预览

## 反馈

如果你有任何建议或发现问题，欢迎反馈！
